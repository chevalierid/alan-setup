*$
* LM3691
*****************************************************************************
* (C) Copyright 2016 Texas Instruments Incorporated. All rights reserved.
*****************************************************************************
** This model is designed as an aid for customers of Texas Instruments.
** TI and its licensors and suppliers make no warranties, either expressed
** or implied, with respect to this model, including the warranties of
** merchantability or fitness for a particular purpose.  The model is
** provided solely on an "as is" basis.  The entire risk as to its quality
** and performance is with the customer
*****************************************************************************
*
** Released by: WEBENCH Design Center, Texas Instruments Inc.
* Part: LM3691
* Date: 28APR2016
* Model Type: Transient
* Simulator: PSPICE
* Simulator Version: 16.2.0.p001
* EVM Order Number: AN-1772
* EVM User's Guide: SNVA312B-May 2008-Revised April 2013
* Datasheet: SNVS506I -MAY 2008-REVISED MAY 2013
*
* Model Version: Final 1.10
*
*****************************************************************************
*
* Updates:
*
* Final 1.10
*< Made these changes to the model >
*       1. Line Transient response is improved.
*       2. Internally GND pin is not connected to 0V to support system level simulations.
*
* Final 1.00
* Release to Web
*
*****************************************************************************
* Model Usage Notes:
*
* 1. The following features have been modelled
*      a. This model is common for all fixed voltage versions (0.75V, 1V, 1.2V, 1.5V, 1.8V, 2.5V, 3.3V) 
*         of LM3691 family of devices by passing parameter 'VOUT'. For Example:'VOUT=0.75' for LM3691-0.75.
*      b. 'STEADY' is another parameter used to enter into steady state output. Keep 'STEADY=0' for 
*         normal start-up and 'STEADY=1' for Steady state output.
*      c. Cycle-by-Cycle current limit with reduced switching frequency and reduced current limit is modelled.
*      d. ECO MODE functionality is modelled.
*      e. Enable and MODE pin functionality are modelled.
* 2. Operating Current, Shut-down Current and Temperature effects are not modelled. 
*
*****************************************************************************
.SUBCKT LM3691_TRANS EN FB SW MODE VIN GND PARAMS: STEADY=0 VOUT=1.8
E_E1         VIN_INT 0 VALUE { V(VIN, GND) }
X_U5_U24         U5_N17001153 U5_N17001144 d_d1 
V_U5_V5         U5_N17001144 0 2
E_U5_ABM2         U5_VREF_OLD 0 VALUE { {IF(V(U5_N17001153)>=(VOUT/2), VOUT/2,
+  V(U5_N17001153))}    }
X_U5_U25         0 U5_N17001153 d_d1 
G_U5_ABMII2         0 U5_N17001153 VALUE { IF(V(UVLO_EN_OK)>0.5, 15u, 0)    }
R_U5_R20         VREF U5_VREF_OLD  700K  
C_U5_C78         VREF 0  10p  
C_U5_C77         VIN_INT VREF  0.2p  
X_U5_S2    UVLO_EN_OK 0 U5_N17001153 0 SS_VREF_U5_S2 
E_U5_ABM31         VREF_PLUS 0 VALUE { IF(V(P20MV)>0.5 &  
+ + V(ECO_MODE)>0.5, 1, 0)   }
C_U5_C8         U5_N17001153 0  1n IC={STEADY*(VOUT/2)} TC=0,0 
R_U5_R18         UVLO_EN_OK STRT_DLY  288 TC=0,0 
X_U5_U29         U5_N169998351 UVLO_EN_OK d_d1 
C_U5_C20         STRT_DLY 0  1u IC={STEADY*1} TC=0,0 
R_U5_R19         U5_N169998351 STRT_DLY  3 TC=0,0 
E_U5_ABM32         RST_IDLE 0 VALUE { IF(V(VREF_PLUS)<0.05 &  
+ + V(VREF)>V(FB_DIV), 1, 0)   }
E_E2         FB_INT 0 VALUE { V(FB, GND) }
X_U6_U19         UVLO_EN_OK SDWN INV_BASIC_GEN PARAMS: VDD=1 VSS=0
+  VTHRESH=500E-3
X_U6_U1         VIN_INT U6_N16769390 U6_N16769398 U6_UVLO_OK COMPHYS_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=0.5
V_U6_V2         U6_N16769390 0 2.2
R_U6_R39         U6_N16770642 U6_N16774113  3 TC=0,0 
V_U6_V4         U6_N16769398 0 0.1
X_U6_U2         EN_INT U6_N16771352 U6_N16771380 U6_EN_OK COMPHYS_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=0.5
V_U6_V5         U6_N16771352 0 1.2
X_U6_U3         MODE_INT U6_N16779577 U6_N16779591 MODE_OK COMPHYS_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=0.5
V_U6_V6         U6_N16771380 0 0.8
X_U6_U20         U6_N16774113 U6_N16771874 d_d1 
X_U6_U65         U6_UVLO_OK U6_EN_OK U6_N16771874 AND2_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
V_U6_V7         U6_N16779577 0 1.2
R_U6_R38         U6_N16770642 U6_N16771874  100K TC=0,0 
E_U6_ABM9         UVLO_EN_OK 0 VALUE { {IF(((VOUT==0.75) | (VOUT==1.0) |
+  (VOUT==1.2) | (VOUT==1.5) | (VOUT==1.8) | (VOUT==2.5) | (VOUT==3.3)) &
+  V(U6_N16770642)>0.5, 1, 0)}    }
V_U6_V8         U6_N16779591 0 0.8
C_U6_C3         U6_N16770642 0  1n IC={STEADY*1} TC=0,0 
V_U4_V33         U4_N17892535 0 7.75
E_U4_E10         U4_COUNT24 0 VALUE { {IF (V(U4_VCOUNTER24) > V(U4_N17891804),
+  1, 0)} }
C_U4_C13         GND U4_N16820994  5p IC=0 
X_U4_U805         U4_NCH_AVG U4_PCH_PEAK U4_ECO_MODE_HIT OR2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
C_U4_C18         U4_IPEAK 0  1n IC=0 
X_U4_U821         U4_STEADY_DLY U4_N18365414 INV_BASIC_GEN PARAMS: VDD=1 VSS=0
+  VTHRESH=500E-3
X_U4_U73         U4_N17891517 U4_N17892076 PWM_ST N17891476
+  srlatchrhp_basic_gen PARAMS: VDD=1 VSS=0 VTHRESH=0.5
X_U4_U808         ECO_MODE U4_N18530657 INV_BASIC_GEN PARAMS: VDD=1 VSS=0
+  VTHRESH=500E-3
X_U4_U809         U4_PWM_16_PUL_MIS U4_N17916569 U4_ECO_MISS OR2_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=500E-3
C_U4_C16         0 U4_N17891563  1n IC=0 
R_U4_R21         U4_IDLE_RST U4_N17892302  15  
E_U4_GAIN2         P20MV 0 VALUE {1 * V(U4_VTAR_20MV_ST)}
E_U4_ABM28         U4_N18759960 0 VALUE { IF(V(STRT_DLY)>0.5,   
+ +V(U4_N17892576), 0)   }
E_U4_ABM10         U4_N18124790 0 VALUE { IF(V(U4_N18126812)>0.5, 0, 1)    }
V_U4_V24         U4_N17891792 0 12
E_U4_ABM26         U4_N18295591 0 VALUE { IF(V(ECO_MODE)>0.5,   
+ +V(N_DRV), 1)   }
X_U4_U811         U4_N17892583 U4_PWM_16_PUL U4_N18468508 OR2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
X_U4_U804         U4_NO_ECO U4_N17892654 INV_BASIC_GEN PARAMS: VDD=1 VSS=0
+  VTHRESH=500E-3
X_U4_U45         U4_N18124790 U4_N18121820 d_d1 
X_U4_U5         U4_N18187598 U4_IPEAK U4_PCH_PEAK COMP_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=0.5
X_U4_U814         U4_ECO_OFF U4_NO_ECO IDLE_ST U4_VTAR_20MV_ST U4_N17891559
+  OR4_BASIC_GEN PARAMS: VDD=1 VSS=0 VTHRESH=500E-3
R_U4_R152         U4_CL_RST U4_N18509684  720 TC=0,0 
G_U4_ABM2I12         0 U4_VCOUNTER24 VALUE { (V(U4_N18759960) - V(0)) * 500e-3 
+    }
R_U4_R28         U4_N17891547 U4_N18478018  35  
X_U4_U35         U4_VCOUNTER24 U4_N17891792 d_d1 
X_U4_U74         U4_N17892354 U4_N17891563 U4_N17891698 N17892370
+  srlatchrhp_basic_gen PARAMS: VDD=1 VSS=0 VTHRESH=0.5
X_U4_U806         U4_NCH_AVG N18295596 U4_N18295591 U4_N18082210 0 0
+  dffsr_rhpbasic_gen PARAMS: VDD=1 VSS=0 VTHRESH=500E-3
R_U4_R18         U4_N16820994 U4_N16820800  10k  
C_U4_C42         0 U4_NO_ECO  1n IC=0 
X_U4_U40         U4_N17891650 IDLE_ST d_d1 
V_U4_V6         U4_N18187598 0 100m
E_U4_E17         U4_1P8_VT 0 TABLE { V(VIN_INT, 0) } 
+ ( (2.3, 5.75m) (5.5, 1m) )
V_U4_V34         U4_N18341147 0 1
X_U4_U155         U4_N18187538 U4_N18187671 N18187650 MONOPOS_PS PARAMS: PW=1n
R_U4_R58         U4_N18209808 U4_NO_ECO  14.43  
C_U4_C14         GND U4_N16820800  5p IC=0 
X_U4_U43         U4_TEST_ECO U4_N17892069 d_d1 
X_U4_U820         U4_ECO_MODE_HIT U4_N17897489 INV_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
X_U4_U827         U4_N17897466 U4_N17897468 U4_N18209808 N17897453
+  srlatchshp_basic_gen PARAMS: VDD=1 VSS=0 VTHRESH=0.5
X_U4_U7         U4_N18509684 U4_CL_RST d_d1 
C_U4_C9         0 U4_N17536933  1n IC=0 TC=0,0 
C_U4_C20         0 IDLE_ST  1n IC=0 
C_U4_C19         0 U4_IDLE_RST  1n IC=0 
C_U4_C41         0 U4_N18121820  1n IC=0 
X_U4_U46         U4_N18209808 U4_NO_ECO d_d1 
X_U4_U815         U4_N18530657 U4_CL_RST U4_ECO_OFF OR2_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
X_U4_S11    U4_RST_CNT 0 U4_VCOUNTER24 0 ECO_CURRENT_SENSE_LIMIT_U4_S11 
X_U4_U183         PWM_ST U4_COUNT16 U4_N17891890 AND2_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
X_U4_U41         U4_N17891698 U4_VTAR_20MV_ST d_d1 
X_U4_U38         U4_N17892188 U4_N17891563 d_d1 
C_U4_C27         0 U4_N17891547  1n IC=0 
E_U4_ABM13         U4_N18509684 0 VALUE { V(U4_N18775681)    }
E_U4_ABM23         U4_N17707840 0 VALUE { IF(V(ECO_MODE)>0.5,   
+ +V(N_DRV), 0)   }
C_U4_C29         U4_CL_RST 0  1n IC=0 TC=0,0 
R_U4_R57         U4_N18124790 U4_N18121820  14.43  
C_U4_C24         0 U4_N17892069  1n IC=0 
R_U4_R22         IDLE_ST U4_N17891650  15  
X_U4_U178         U4_NO_ECO U4_N17891702 U4_N17916569 AND2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
X_U4_U176         CLK U4_N17897489 U4_N17897496 AND2_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
X_U4_S4    U4_N18187510 0 ISENSE U4_IPEAK ECO_CURRENT_SENSE_LIMIT_U4_S4 
C_U4_C17         0 U4_VCOUNTER24  10n IC=0 
R_U4_R26         U4_N17892069 U4_TEST_ECO  15  
R_U4_R16         SW U4_N16836370  1k  
C_U4_C21         0 U4_VTAR_20MV_ST  1n IC=0 
X_U4_U47         U4_STEADY_DLY U4_N18341147 d_d1 
R_U4_R20         U4_N17891563 U4_N17892188  15  
E_U4_ABM12         U4_CL 0 VALUE { IF (V(U4_N17536933)>0.5, 1, 0)    }
X_U4_U42         U4_N17891890 U4_N17892354 d_d1 
E_U4_ABM19         U4_N17891517 0 VALUE { IF(V(U4_N17891892)>0.5 &  
+ +V(U4_VCOUNTER24)<0.4, 1, 0)   }
R_U4_R23         U4_VTAR_20MV_ST U4_N17891698  15  
X_U4_U173         U4_ECO_MODE_HIT CLK U4_PWM_16_PUL AND2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
I_U4_I1         VIN U4_N16836370 DC 3u  
R_U4_R55         MODE_OK U4_MODE_DLY  10  
X_U4_U810         U4_ECO_MISS U4_ECO_OFF IDLE_ST U4_N17892188 OR3_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=500E-3
X_U4_U181         U4_VTAR_20MV_ST CLK U4_N17892583 AND2_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
C_U4_C22         0 U4_N17892354  1n IC=0 
C_U4_C40         0 U4_N17897466  1n IC=0 
R_U4_R14         U4_N17536930 U4_N17536933  10 TC=0,0 
R_U4_R24         U4_N17892354 U4_N17891890  15  
E_U4_ABM27         U4_N18187501 0 VALUE { IF(V(U4_N18187538)>0.5 &   
+ +V(U4_N18187671)>0.5, 1, 0)   }
X_U4_U39         U4_N17892302 U4_IDLE_RST d_d1 
E_U4_E18         U4_3P3_VT 0 TABLE { V(VIN_INT, 0) } 
+ ( (3.3, 34m) (3.8, 28m) (4, 21m) (4.5, 12.8m) (5, 11.5m) (5.5,10m) )
C_U4_C39         0 U4_MODE_DLY  1n IC=0 
R_U4_R56         U4_N17897496 U4_N17897466  5  
C_U4_C15         0 U4_N17892076  1n IC=0 
X_U4_U175         U4_VTAR_20MV_ST U4_CNT24_DONE U4_N18692348 AND2_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=500E-3
C_U4_C38         0 U4_RST_CNT  144p IC=0 
X_U4_U816         U4_N18374186 U4_IDLE_RST U4_ECO_OFF U4_PWM_16_PUL_MIS
+  U4_N17891968 OR4_BASIC_GEN PARAMS: VDD=1 VSS=0 VTHRESH=500E-3
R_U4_R151         CL_DLY U4_N18509684  43.3 TC=0,0 
X_U4_U825         CLK U4_ECO_MODE_HIT U4_N17897468 OR2_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
R_U4_R17         U4_N16843421 U4_N16820994  10k  
X_U4_U174         U4_NO_ECO PWM_ST U4_PWM_16_PUL_MIS AND2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
R_U4_R54         U4_N17891968 U4_RST_CNT  1k  
X_U4_U76         U4_N18464011 U4_RST_CNT U4_STRT_CNT N18464955
+  srlatchrhp_basic_gen PARAMS: VDD=1 VSS=0 VTHRESH=0.5
C_U4_C23         0 U4_N17892279  1n IC=0 
C_U4_C28         0 U4_N17891702  1n IC=0 
E_U4_E16         U4_2P5_VT 0 TABLE { V(VIN_INT, 0) } 
+ ( (2.3,20m) (3, 14.6m) (5.5,3m) )
X_U4_U826         RST_IDLE CLK IDLE_ST U4_N17892265 AND3_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
X_U4_U177         U4_N17891702 U4_N17892654 U4_TEST_ECO AND2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
R_U4_R52         U4_COUNT24 U4_CNT24_DONE  1k  
X_U4_U156         U4_N17891547 U4_N18464011 N18464482 MONOPOS_PS PARAMS: PW=25n
C_U4_C26         CL_DLY 0  1n IC=0 TC=0,0 
X_U4_U48         U4_N18692348 U4_N17891702 d_d1 
X_U4_U36         U4_N17891968 U4_RST_CNT d_d1 
E_U4_ABM15         U4_N17536930 0 VALUE { IF (V(U4_CL_TRIP)>0.5, 1, 0)    }
C_U4_C25         U4_STEADY_DLY 0  1n IC=0 
X_U4_U33         U4_COUNT24 U4_CNT24_DONE d_d1 
X_U4_U4         U4_N18509684 CL_DLY d_d1 
R_U4_R29         U4_N17891702 U4_N18692348  35  
X_U4_U34         0 U4_VCOUNTER24 d_d1 
X_U4_U180         U4_N18468508 U4_STRT_CNT U4_N18126812 AND2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
E_U4_E15         U4_1P5_VT 0 TABLE { V(VIN_INT, 0) } 
+ ( (2.3,4m) (5.5,0) )
V_U4_V30         U4_N18187501 U4_N18187510 0Vdc
R_U4_R19         U4_N17892076 U4_N17891559  15  
R_U4_R27         U4_STEADY_DLY U4_N18341147  28.86k  
R_U4_R25         U4_N17892279 U4_N17892265  50  
X_U4_U179         U4_PWM_16_PUL U4_STEADY_DLY U4_N17891892 AND2_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=500E-3
C_U4_C36         0 U4_CNT24_DONE  144p IC=0 
X_U4_U44         U4_N17892265 U4_N17892279 d_d1 
E_U4_ABM29         U4_N18478018 0 VALUE { IF(V(PWM_ST)>0.5 &   
+ V(U4_RST_CNT)<0.1, 1, 0)   }
E_U4_ABM22         U4_N18511216 0 VALUE { IF(V(FB_INT)>0.35, 1.5,   
+ 0.5)   }
E_U4_ABM21         U4_N18187538 0 VALUE { IF(V(ECO_MODE)>0.5,  
+ +V(DRIVE), 0)   }
X_U4_U37         U4_N17891559 U4_N17892076 d_d1 
X_U4_U813         U4_ECO_MISS U4_N18365414 U4_N18374186 OR2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
E_U4_ABM24         U4_N17892576 0 VALUE { IF(V(U4_N18126812)>0.5 &   
+ +V(U4_N18121820)>0.5, 1, 0)   }
X_U4_U75         U4_N17892069 U4_IDLE_RST U4_N17891650 N17892049
+  srlatchrhp_basic_gen PARAMS: VDD=1 VSS=0 VTHRESH=0.5
X_U4_S1    U4_N17707840 0 U4_N16836370 U4_N16843421
+  ECO_CURRENT_SENSE_LIMIT_U4_S1 
E_U4_ABM31         U4_N18010130 0 VALUE { {IF((VOUT==1.5), V(U4_1P5_VT),
+  (IF((VOUT==2.5), V(U4_2P5_VT), (IF((VOUT==1.8), V(U4_1P8_VT), (IF((VOUT==3.3),
+  V(U4_3P3_VT), 0)))))))}    }
X_U4_U157         U4_N18187538 U4_RIS_EDG N18187545 MONOPOS_PS PARAMS: PW=10n
V_U4_V5         U4_N18511165 0 1.5
X_U4_U14         U4_CL CLK U4_N18775681 N18509734 srlatchrhp_basic_gen PARAMS:
+  VDD=1 VSS=0 VTHRESH=0.5
E_U4_ABM30         ECO_MODE 0 VALUE { IF(V(STRT_DLY)>0.5 &  
+ +V(SDWN)<0.5 &  
+ +V(U4_MODE_DLY)<0.5, 1, 0)  }
E_U4_E14         U4_COUNT16 0 VALUE { {IF (V(U4_VCOUNTER24) > V(U4_N17892535),
+  1, 0)} }
V_U4_V25         U4_N17891804 0 11.75
X_U4_U812         U4_ECO_OFF U4_N17892279 U4_N17892302 OR2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
E_U4_E19         U4_N18007277 0 VALUE { V(U4_N16820800, GND) }
E_U4_ABM25         U4_N18082210 0 VALUE { IF(V(U4_N18007277)>  
+ +V(U4_N18010130), 1, 0)   }
X_U4_U6         ISENSE U4_N18511216 U4_CL_TRIP COMP_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=0.5
E_E3         EN_INT 0 VALUE { V(EN, GND) }
X_U2_H1    VIN U2_N16793859 ISENSE 0 Driver_Powerfets_U2_H1 
X_U2_U73         U2_N167940743 U2_N16814244 N_DRV AND2_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
X_U2_S2    N_DRV 0 SW GND Driver_Powerfets_U2_S2 
X_U2_S1    U2_N16794048 0 U2_N16793859 SW Driver_Powerfets_U2_S1 
V_U2_V2         P_DRV U2_N16794048 0Vdc
E_U2_ABM3         U2_N16819988 0 VALUE { IF(V(FB_INT) < 0.35, 1,0)    }
E_U2_ABM2         U2_N16793791 0 VALUE { IF(V(DRIVE) > 0.95, 1,0)    }
X_U2_U14         U2_N16819988 CLK N16820002 U2_N16814244 srlatchrhp_basic_gen
+  PARAMS: VDD=1 VSS=0 VTHRESH=0.5
X_U2_U9         U2_N16838043 U2_N16794123 U2_N16793706 P_DRV MUX2_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=0.5
V_U2_V1         U2_N16794123 0 1
X_U2_U70         SDWN IDLE CL_DLY U2_N16793706 OR3_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
X_U2_U22         SW U2_N16793859 d_d1 
X_U2_U68         U2_N16793791 U2_N16793706 U2_N16838043 OR2_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=500E-3
X_U2_U23         GND SW d_d1 
X_U2_U8         U2_N16838043 0 U2_N16793706 U2_N167940743 MUX2_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=0.5
E_E4         MODE_INT 0 VALUE { V(MODE, GND) }
X_U1_U805         CLK U1_PWM N17095704 U1_N17141277 srlatchshp_basic_gen
+  PARAMS: VDD=1 VSS=0 VTHRESH=0.5
X_U1_U807         U1_N17141277 U1_N17140948 DRIVE AND2_BASIC_GEN PARAMS: VDD=1
+  VSS=0 VTHRESH=500E-3
R_U1_R27         CL_DLY U1_CL_DELAY  100 TC=0,0 
V_U1_V3         U1_N16932026 0  
+PULSE 0 1 0 1n 1n 10n 250n
E_U1_ABM8         IDLE 0 VALUE { IF(V(IDLE_ST)>0.5 &   
+ V(U1_CL_DELAY)<0.5, 1, 0)   }
E_U1_E3         U1_RAMP U1_N16931917 VALUE { IF(V(UVLO_EN_OK, 0)>0.5, 1.5, 0) }
C_U1_C26         U1_CL_DELAY 0  1n IC=0 TC=0,0 
X_U1_U4         CL_DLY U1_CL_DELAY d_d1 
G_U1_ABMII1         0 U1_N16931917 VALUE { IF(V(UVLO_EN_OK)>0.5 & V(IDLE)<0.5 &
+  V(CLK)<0.5 , IF(V(FB_INT)<0.15, (V(VIN_INT)*0.18-0.1)*2.0408,
+  4.167*(V(VIN_INT)*0.18-0.1)), 0)    }
E_U1_ABM7         U1_N16932188 0 VALUE { IF(V(UVLO_EN_OK)>0.5,  
+ V(CLK), 1)   }
X_U1_U808         CLK U1_N17140948 INV_BASIC_GEN PARAMS: VDD=1 VSS=0
+  VTHRESH=500E-3
C_U1_C15         U1_N16931917 0  1u IC=0 TC=0,0 
X_U1_S5    U1_N16932188 0 U1_N16931917 0 OSC_RAMPDRIVE_U1_S5 
V_U1_V4         U1_N16992247 0  
+PULSE 0 1 0 1n 1n 10n 500n
R_U1_R150         0 U1_PWM  100E6 TC=0,0 
X_U1_U1         U1_PWM U1_N17019594 d_d1 
E_U1_ABM6         CLK 0 VALUE { IF(V(FB_INT)>0.15, V(U1_N16932026),  
+ V(U1_N16992247))   }
X_U1_U2         0 U1_PWM d_d1 
X_U1_U3         U1_N16931917 VIN_INT d_d1 
V_U1_V1         U1_N17019594 0 1
G_U1_ABM2I1         0 U1_PWM VALUE { IF(V(COMP)>V(U1_RAMP), -10000u, 10000u)   
+  }
R_U3_R147         FB_DIV FB_INT  172k TC=0,0 
G_U3_ABMII3         0 U3_OFFSET VALUE { IF(V(VREF_PLUS)>0.5, 150u, 0)    }
C_U3_C90         U3_N17648436 0  100p  TC=0,0 
R_U3_R148         U3_N17739538 FB_DIV  172k TC=0,0 
X_U3_S8    IDLE 0 U3_N17648303 0 Error_Amp_U3_S8 
V_U3_V4         U3_N17686250 0 1.565
C_U3_C87         FB_INT FB_DIV  1p IC={STEADY*(VOUT/2)} TC=0,0 
X_U3_U2         U3_N17686250 COMP d_d1 
V_U3_V7         U3_N17674796 0 2.5
V_U3_V6         U3_N17678355 0 35m
X_U3_U3         COMP U3_N17674796 d_d1 
X_U3_S3    VREF_PLUS 0 U3_OFFSET 0 Error_Amp_U3_S3 
E_U3_ABM38         U3_N17739538 0 VALUE { IF(V(VREF_PLUS)>0.5, -V(U3_OFFSET),
+  0)    }
C_U3_C9         U3_OFFSET 0  1n IC=0 TC=0,0 
C_U3_C40         U3_N17648303 0  32p  TC=0,0 
G_U3_ABMII19         U3_N17648404 0 VALUE { IF(V(UVLO_EN_OK)>0.5 & V(IDLE)<0.5,
+  V(U3_N17648436)*3m, 0)    }
R_U3_R154         U3_N17648404 0  8k TC=0,0 
X_U3_U14         U3_N17648303 U3_N17648831 d_d_lm3691 
E_U3_ABM36         U3_N17648438 0 VALUE { V(FB_DIV)-V(VREF)     }
X_U3_U15         U3_N17693425 U3_N17648303 d_d_lm3691 
G_U3_ABMII7         U3_N17648303 0 VALUE { IF(V(UVLO_EN_OK)>0.5,
+  IF(V(IDLE)<0.5, V(U3_N17648436)*30u, 0), 1u)    }
C_U3_C3         FB_DIV 0  700f IC={STEADY*(VOUT/2)} TC=0,0 
V_U3_V5         U3_N17693425 0 1.565
C_U3_CFF         U3_FF COMP  4p IC=0 TC=0,0 
X_U3_U16         0 U3_OFFSET d_d_lm3691 
X_U3_U17         U3_OFFSET U3_N17678355 d_d_lm3691 
X_U3_S9    U3_N17648615 0 U3_N17648404 U3_FF Error_Amp_U3_S9 
E_U3_ABM37         U3_N17648615 0 VALUE { IF(V(IDLE)<0.5, V(DRIVE), 1)    }
R_U3_R149         COMP U3_N17648303  33k TC=0,0 
V_U3_V8         U3_N17648831 0 2.5
R_U3_R153         U3_N17648436 U3_N17648438  300 TC=0,0 
.ENDS LM3691_TRANS
*$
.subckt SS_VREF_U5_S2 1 2 3 4  
S_U5_S2         3 4 1 2 _U5_S2
RS_U5_S2         1 2 1G
.MODEL         _U5_S2 VSWITCH Roff=1e7 Ron=1m Voff=0.9 Von=0.1
.ends SS_VREF_U5_S2
*$
.subckt ECO_CURRENT_SENSE_LIMIT_U4_S11 1 2 3 4  
S_U4_S11         3 4 1 2 _U4_S11
RS_U4_S11         1 2 1G
.MODEL         _U4_S11 VSWITCH Roff=10e6 Ron=1m Voff=0.2 Von=0.8
.ends ECO_CURRENT_SENSE_LIMIT_U4_S11
*$
.subckt ECO_CURRENT_SENSE_LIMIT_U4_S4 1 2 3 4  
S_U4_S4         3 4 1 2 _U4_S4
RS_U4_S4         1 2 1G
.MODEL         _U4_S4 VSWITCH Roff=1e7 Ron=1m Voff=0.05 Von=0.5
.ends ECO_CURRENT_SENSE_LIMIT_U4_S4
*$
.subckt ECO_CURRENT_SENSE_LIMIT_U4_S1 1 2 3 4  
S_U4_S1         3 4 1 2 _U4_S1
RS_U4_S1         1 2 1G
.MODEL         _U4_S1 VSWITCH Roff=1e7 Ron=1.0 Voff=0.7 Von=0.9
.ends ECO_CURRENT_SENSE_LIMIT_U4_S1
*$
.subckt Driver_Powerfets_U2_H1 1 2 3 4  
H_U2_H1         3 4 VH_U2_H1 1
VH_U2_H1         1 2 0V
.ends Driver_Powerfets_U2_H1
*$
.subckt Driver_Powerfets_U2_S2 1 2 3 4  
S_U2_S2         3 4 1 2 _U2_S2
RS_U2_S2         1 2 1G
.MODEL         _U2_S2 VSWITCH Roff=1e6 Ron=115m Voff=0.1V Von=0.9V
.ends Driver_Powerfets_U2_S2
*$
.subckt Driver_Powerfets_U2_S1 1 2 3 4  
S_U2_S1         3 4 1 2 _U2_S1
RS_U2_S1         1 2 1G
.MODEL         _U2_S1 VSWITCH Roff=1e6 Ron=160m Voff=0.9V Von=0.1V
.ends Driver_Powerfets_U2_S1
*$
.subckt OSC_RAMPDRIVE_U1_S5 1 2 3 4  
S_U1_S5         3 4 1 2 _U1_S5
RS_U1_S5         1 2 1G
.MODEL         _U1_S5 VSWITCH Roff=1e7 Ron=0.1m Voff=0.1 Von=0.9
.ends OSC_RAMPDRIVE_U1_S5
*$
.subckt Error_Amp_U3_S8 1 2 3 4  
S_U3_S8         3 4 1 2 _U3_S8
RS_U3_S8         1 2 1G
.MODEL         _U3_S8 VSWITCH Roff=1E9 Ron=70E6 Voff=0.9 Von=0.1
.ends Error_Amp_U3_S8
*$
.subckt Error_Amp_U3_S3 1 2 3 4  
S_U3_S3         3 4 1 2 _U3_S3
RS_U3_S3         1 2 1G
.MODEL         _U3_S3 VSWITCH Roff=1e7 Ron=1m Voff=0.9 Von=0.1
.ends Error_Amp_U3_S3
*$
.subckt Error_Amp_U3_S9 1 2 3 4  
S_U3_S9         3 4 1 2 _U3_S9
RS_U3_S9         1 2 1G
.MODEL         _U3_S9 VSWITCH Roff=1e6 Ron=1u Voff=0.9 Von=0.1
.ends Error_Amp_U3_S9
*$
.SUBCKT COMP_BASIC_GEN INP INM Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5	
E_ABM Yint 0 VALUE {IF (V(INP) > 
+ V(INM), {VDD},{VSS})}
R1 Yint Y 1
C1 Y 0 1n
.ENDS COMP_BASIC_GEN
*$
.SUBCKT COMPHYS_BASIC_GEN INP INM HYS OUT PARAMS: VDD=1 VSS=0 VTHRESH=0.5	
EIN INP1 INM1 INP INM 1 
EHYS INP1 INP2 VALUE { IF( V(1) > {VTHRESH},-V(HYS),0) }
EOUT OUT 0 VALUE { IF( V(INP2)>V(INM1), {VDD} ,{VSS}) }
R1 OUT 1 1
C1 1 0 5n
RINP1 INP1 0 1K
.ENDS COMPHYS_BASIC_GEN
*$
.SUBCKT AND2_BASIC_GEN A B Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
E_ABMGATE    YINT 0 VALUE {{IF(V(A) > {VTHRESH}  &  
+ V(B) > {VTHRESH},{VDD},{VSS})}}
RINT YINT Y 1
CINT Y 0 1n
.ENDS AND2_BASIC_GEN
*$
.SUBCKT AND3_BASIC_GEN A B C Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
E_ABMGATE    YINT 0 VALUE {{IF(V(A) > {VTHRESH}  &  
+ V(B) > {VTHRESH} &
+ V(C) > {VTHRESH},{VDD},{VSS})}}
RINT YINT Y 1
CINT Y 0 1n
.ENDS AND3_BASIC_GEN
*$
.SUBCKT OR2_BASIC_GEN A B Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
E_ABMGATE    YINT 0 VALUE {{IF(V(A) > {VTHRESH}  |  
+ V(B) > {VTHRESH},{VDD},{VSS})}}
RINT YINT Y 1
CINT Y 0 1n
.ENDS OR2_BASIC_GEN
*$
.SUBCKT OR3_BASIC_GEN A B C Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
E_ABMGATE    YINT 0 VALUE {{IF(V(A) > {VTHRESH}  |  
+ V(B) > {VTHRESH} |
+ V(C) > {VTHRESH},{VDD},{VSS})}}
RINT YINT Y 1
CINT Y 0 1n
.ENDS OR3_BASIC_GEN
*$
.SUBCKT OR4_BASIC_GEN A B C D Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
E_ABMGATE    YINT 0 VALUE {{IF(V(A) > {VTHRESH}  |  
+ V(B) > {VTHRESH} |
+ V(C) > {VTHRESH} |
+ V(D) > {VTHRESH},{VDD},{VSS})}}
RINT YINT Y 1
CINT Y 0 1n
.ENDS OR4_BASIC_GEN
*$
.SUBCKT INV_BASIC_GEN A  Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
E_ABMGATE    YINT 0 VALUE {{IF(V(A) > {VTHRESH} , 
+ {VSS},{VDD})}}
RINT YINT Y 1
CINT Y 0 1n
.ENDS INV_BASIC_GEN
*$
.SUBCKT MUX2_BASIC_GEN A B S Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
E_ABMGATE  YINT 0 VALUE {{IF(V(S) > {VTHRESH},  
+ V(B),V(A))}}
RINT YINT Y 1
CINT Y 0 1n
.ENDS MUX2_BASIC_GEN
*$
**Set has higher priority in this latch
.SUBCKT SRLATCHSHP_BASIC_GEN S R Q QB PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
GQ 0 Qint VALUE = {IF(V(S) > {VTHRESH},5,IF(V(R)>{VTHRESH},-5, 0))}
CQint Qint 0 1n
RQint Qint 0 1000MEG
D_D10 Qint MY5 D_D1
V1 MY5 0 {VDD}
D_D11 MYVSS Qint D_D1
V2 MYVSS 0 {VSS} 
EQ Qqq 0 Qint 0 1
X3 Qqq Qqqd1 BUF_BASIC_GEN PARAMS: VDD={VDD} VSS={VSS} VTHRESH={VTHRESH}
RQq Qqqd1 Q 1
*EQb Qbr 0 VALUE = {IF( V(Q) > {VTHRESH}, {VSS},{VDD})}
*RQb Qbr QB 1 
EQb QB 0 VALUE = {1-V(Q)} 
Cdummy1 Q 0 1n 
Cdummy2 QB 0 1n 
.IC V(Qint) {VSS}
.MODEL D_D1 D( IS=1e-15 TT=10p Rs=0.05 N=.1  )
.ENDS SRLATCHSHP_BASIC_GEN
*$
**Reset has higher priority in this latch
.SUBCKT SRLATCHRHP_BASIC_GEN S R Q QB PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
GQ 0 Qint VALUE = {IF(V(R) > {VTHRESH},-5,IF(V(S)>{VTHRESH},5, 0))}
CQint Qint 0 1n
RQint Qint 0 1000MEG
D_D10 Qint MY5 D_D1
V1 MY5 0 {VDD}
D_D11 MYVSS Qint D_D1
V2 MYVSS 0 {VSS} 
EQ Qqq 0 Qint 0 1
X3 Qqq Qqqd1 BUF_BASIC_GEN PARAMS: VDD={VDD} VSS={VSS} VTHRESH={VTHRESH}
RQq Qqqd1 Q 1
*EQb Qbr 0 VALUE = {IF( V(Q) > {VTHRESH}, {VSS},{VDD})}
*RQb Qbr QB 1 
EQb QB 0 VALUE = {1-V(Q)} 
Cdummy1 Q 0 1n 
Cdummy2 QB 0 1n
.IC V(Qint) {VSS}
.MODEL D_D1 D( IS=1e-15 TT=10p Rs=0.05 N=.1  )
.ENDS SRLATCHRHP_BASIC_GEN
*$
.SUBCKT DFFSR_RHPBASIC_GEN Q QB CLK D R S PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
***Set has higher priority in this
** Changed the delay from 7n/10n to 15n/20n to help larger time step simulations
**Faster flip-flops require a a smaller time step to simulate
X1 CLK CLKdel INV_DELAY_BASIC_GEN PARAMS: VDD={VDD} VSS={VSS} VTHRESH={VTHRESH} DELAY = 15n
X2 CLK CLKdel CLKint AND2_BASIC_GEN PARAMS: VDD={VDD} VSS={VSS} VTHRESH={VTHRESH}  
GQ 0 Qint VALUE = {IF(V(R) > {VTHRESH},-5,IF(V(S) > {VTHRESH},5, IF(V(CLKint)> {VTHRESH}, 
+ IF(V(D)> {VTHRESH},5,-5),0)))}
CQint Qint 0 1n
RQint Qint 0 1000MEG
D_D10 Qint MY5 D_D1
V1 MY5 0 {VDD}
D_D11 MYVSS Qint D_D1
V2 MYVSS 0 {VSS} 
EQ Qqq 0 Qint 0 1
X3 Qqq Qqqd1 BUF_DELAY_BASIC_GEN PARAMS: VDD={VDD} VSS={VSS} VTHRESH={VTHRESH} DELAY = 20n
RQq Qqqd1 Q 1
*EQb Qbr 0 VALUE = {IF( V(Q) > {VTHRESH}, {VSS},{VDD})}
*RQb Qbr QB 1 
EQb QB 0 VALUE = {1-V(Q)}
Cdummy1 Q 0 1nF 
Cdummy2 QB 0 1nF 
.IC V(Qint) {VSS}
.MODEL D_D1 D( IS=1e-15 TT=10p Rs=0.05 N=.1  )
.ENDS DFFSR_RHPBASIC_GEN
*$
.SUBCKT CESR IN OUT
+ PARAMs:  C=100u ESR=0.01 X=2 IC=0
C	IN 1  {C*X} IC={IC}
RESR	1 OUT {ESR/X}
.ENDS CESR
*$
.SUBCKT LDCR IN OUT
+ PARAMs:  L=1u DCR=0.01 IC=0
L	IN 1  {L} IC={IC}
RDCR	1 OUT {DCR}
.ENDS LDCR
*$
.SUBCKT D_D1 1 2
D1 1 2 DD1
.MODEL DD1 D( IS=1e-15 TT=10p Rs=0.05 N=.1 )
.ENDS D_D1
*$
.subckt d_d_LM3691 1 2
d1 1 2 dd
.model dd d
+ is=1e-015
+ n=0.0001
+ tt=1e-011
.ends d_d_LM3691
*$
.SUBCKT INV_DELAY_BASIC_GEN A  Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 DELAY = 10n 
E_ABMGATE1    YINT1 0 VALUE {{IF(V(A) > {VTHRESH} , 
+ {VDD},{VSS})}}
RINT YINT1 YINT2 1
CINT YINT2 0 {DELAY*1.3}
E_ABMGATE2    YINT3 0 VALUE {{IF(V(YINT2) > {VTHRESH} , 
+ {VSS},{VDD})}}
RINT2 YINT3 Y 1
CINT2 Y 0 1n
.ENDS INV_DELAY_BASIC_GEN
*$
.SUBCKT BUF_DELAY_BASIC_GEN A  Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 DELAY = 10n 
E_ABMGATE1    YINT1 0 VALUE {{IF(V(A) > {VTHRESH} , 
+ {VDD},{VSS})}}
RINT YINT1 YINT2 1
CINT YINT2 0 {DELAY*1.3}
E_ABMGATE2    YINT3 0 VALUE {{IF(V(YINT2) > {VTHRESH} , 
+ {VDD},{VSS})}}
RINT2 YINT3 Y 1
CINT2 Y 0 1n
.ENDS BUF_DELAY_BASIC_GEN
*$
.SUBCKT BUF_BASIC_GEN A  Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
E_ABMGATE    YINT 0 VALUE {{IF(V(A) > {VTHRESH} , 
+ {VDD},{VSS})}}
RINT YINT Y 1
CINT Y 0 1n
.ENDS BUF_BASIC_GEN
*$
.SUBCKT MONOPOS_PS in Q Qn PARAMS: PW=1u 
VS VSUP 0 DC 1
GIN VSUP YA VALUE={IF(V(IN)>0.5, V(VSUP)/1000K, 0)}
GDIS YA 0 VALUE={IF(V(IN)>0.5,0, V(YA)/1m)}
CIN YA 0 1n IC=0
RIN YA 0 1e11
EABM1 YTD 0 VALUE={IF(V(YA)> {PW*1000}, 1, 0)}
RYTD YTD 0 1e11
EXOR P 0 VALUE={IF(V(YTD) > 0.5 ^ V(IN) > .5, 1, 0)}
ROUTpp2 P 0 1e11
EAND1 Q1 0 VALUE={ IF(V(P)>0.5 & V(IN)>0.5, 1, 0)}
Ro1 Q1 Q 1m
Co1 Q 0 1p
ROUT2 Q 0 1e11
EAND2 Qn1 0 VALUE={ IF(V(Q)>0.5, 0, 1)}
Ro2 Qn1 Qn 1m
Co2 Qn 0 1p
ROUT4 Qn 0 1e11
.ENDS MONOPOS_PS
*$