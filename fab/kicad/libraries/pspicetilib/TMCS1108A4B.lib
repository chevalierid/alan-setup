* TMCS1108A4B - Rev. B
* Created by Patrick Simmons; 2021-04-12
* Created with Green-Williams-Lis Current Sense Amp Macro-model Architecture
* Copyright 2021 by Texas Instruments Corporation
******************************************************
* MACRO-MODEL SIMULATED PARAMETERS:
******************************************************
* AC PARAMETERS
**********************
* CLOSED-LOOP OUTPUT IMPEDANCE VS. FREQUENCY (Zout vs. Freq.)
* CLOSED-LOOP SENSITIVITY AND PHASE VS. FREQUENCY  WITH RL, CL EFFECTS (S vs. Freq.)
* COMMON-MODE REJECTION RATIO VS. FREQUENCY (CMRR vs. Freq.)
* POWER SUPPLY REJECTION RATIO VS. FREQUENCY (PSRR vs. Freq.)
* INPUT CURRENT NOISE DENSITY VS. FREQUENCY (in vs. Freq.)
**********************
* DC PARAMETERS
**********************
* SENSITIVITY ERROR (Es)
* INPUT OFFSET CURRENT VS. TEMPERATURE (Ios vs. Temp)
* REFERENCE VOLTAGE REJECTION RATIO (RVRR)
* OUTPUT VOLTAGE SWING vs. OUTPUT CURRENT (Vout vs. Iout)
* SHORT-CIRCUIT OUTPUT CURRENT (Isc)
* QUIESCENT CURRENT (Iq)
**********************
* TRANSIENT PARAMETERS
**********************
* 4-µS SAMPLING INTERVAL
* SLEW RATE (SR)
* SETTLING TIME VS. CAPACITIVE LOAD (ts)
* OVERLOAD RECOVERY TIME (tor)
*****************************************************************************
* Model Version B
*****************************************************************************
* 
* Updates:
*
* Version A - Initial Release
* Version B - 12/30/22. Moved the .MODEL R_NOISELESS statement from outside (global) to inside the top .subckt.
******************************************************
.subckt TMCS1108A4B IN+ IN- VS GND OUT
******************************************************
* SET MODE = 1 for AC/DC SIMULATION
* SET MODE = 0 for TRANSIENT SIMULATION
******************************************************
+ params:
+ MODE = 1
.PARAM CAP=1P
.MODEL R_NOISELESS RES (T_ABS=-273.15)
C_C10         GND N1799114  1E-15   
C_C11         N1799454 GND  1E-15   
C_C12         GND N1799968  1E-15   
C_C13         N1800040 GND  1E-15   
C_C14         GND N1797168  1E-15   
C_C15         N1797268 GND  1E-15   
C_C16         GND N1797802  1E-15   
C_C1A1         N1798758 PSR_V  9.36E-12   
C_C1A6         N1796448 N1796330  2.65E-11   
C_C1A7         N1796956 N1796572  2.65E-11   
C_C1A8         N1797896 N1797260  2.65E-11   
C_C1A9         N1794800 CMR_V  9.36E-12   
C_C1B1         GND N1797580  3.98E-12   
C_C1C1         N1796136 N1796150  5.305E-12   
C_C33         VS_B GND  1E-15   
C_C35         GND SAMPLE  10P   
C_C36         GND CLAMP  19.8N   
C_C8         GND N1795468  1E-15   
C_C9         GND N1796624  1E-15   
C_C_VIMON         GND VIMON  1E-9   
C_C_VOUT_S         GND VOUT_S  1E-9   
E_E3         N1800690 GND OUT GND 1
G_G10         N1797444 GND CL_CLAMP N1796118 -4.44E5
G_G11         N1796448 GND N1797260 GND -3.75
G_G36         N1799290 GND VS GND -1
G_G5         CMR GND CMR_V GND -1
G_G61         N1795322 GND GND IN- -1
G_G62         VICM GND IN+ N1795322 -0.5
G_G64         N1796956 GND N1796330 GND -3.75
G_G65         N1796136 GND N1796572 GND -3.75
G_G66         CMR GND PSR_V GND -1
G_G68         SIG GND ACL GND -1
G_G69         VSENSE GND CLAMP GND -1E-3
G_G70         ACL GND VSENSE GND -1
G_G72         CLAW_CLAMP GND SAMPLE GND -1E-3
G_G73         CL_CLAMP GND CLAW_CLAMP GND -1E-3
G_G8         VS_CLP GND N1795468 GND -1E-3
G_G9         GND_CLP GND N1796624 GND -1E-3
G_GB1         N1797896 GND N1797560 GND -1
G_G_CMR         N1794800 GND VICM GND -2.95E-1
G_G_PSR         N1798758 GND VS_B GND -2.5E-3
G_G_REF         REF GND VS_B GND -0.5
I_I_Q         VS GND DC 4.5E-3  
R_R107         N1799290 GND R_NOISELESS 1
R_R110         N1799290 VS_B R_NOISELESS 1E-3
R_R147         N1795322 GND R_NOISELESS 1
R_R149         REF SENS R_NOISELESS 1E6
R_R152         GND SAMPLE R_NOISELESS 1E9
R_R153         GND SW R_NOISELESS 1E9
R_R154         GND SIG R_NOISELESS 1
R_R155         CLAMP GND R_NOISELESS 1E6
R_R156         VSENSE GND R_NOISELESS 1E3
R_R157         GND ACL R_NOISELESS 1
R_R16         GND N1796448 R_NOISELESS 1
R_R160         VICM GND R_NOISELESS 1
R_R161         GND CLAW_CLAMP R_NOISELESS 1E3
R_R162         GND CL_CLAMP R_NOISELESS 1E3
R_R163         GND REF R_NOISELESS 1
R_R17         GND N1797964 R_NOISELESS 1
R_R18         GND N1796956 R_NOISELESS 1
R_R1A1         N1798758 PSR_V R_NOISELESS 1E8
R_R1A10         N1796330 N1796448 R_NOISELESS 1E4
R_R1A11         N1794800 CMR_V R_NOISELESS 1E8
R_R1A5         N1796572 N1796956 R_NOISELESS 1E4
R_R1A6         N1797260 N1797896 R_NOISELESS 1E4
R_R1B1         N1797580 N1797560 R_NOISELESS 1E4
R_R1C1         N1796150 N1796136 R_NOISELESS 1E4
R_R2         N1798758 GND R_NOISELESS 1E3
R_R20         GND N1797444 R_NOISELESS 1
R_R21         GND N1796136 R_NOISELESS 1
R_R22         GND N1797896 R_NOISELESS 1
R_R29         N1795338 VS_B R_NOISELESS 1E3
R_R2A1         PSR_V GND R_NOISELESS 2.62E5
R_R2A6         GND N1796330 R_NOISELESS 3.64E3
R_R2A7         GND N1796572 R_NOISELESS 3.64E3
R_R2A8         GND N1797260 R_NOISELESS 3.64E3
R_R2A9         CMR_V GND R_NOISELESS 1.7E3
R_R2B1         N1797560 N1797444 R_NOISELESS 3.64E7
R_R2C1         GND N1796150 R_NOISELESS 3E-2
R_R30         N1795468 N1795338 R_NOISELESS 1
R_R31         VS_CLP GND R_NOISELESS 1E3
R_R32         N1796550 GND R_NOISELESS 1E3
R_R33         N1796624 N1796550 R_NOISELESS 1
R_R34         GND_CLP GND R_NOISELESS 1E3
R_R35         GND VS_CLP R_NOISELESS 1E9
R_R36         N1799026 GND R_NOISELESS 1
R_R37         N1799114 N1799026 R_NOISELESS 1E-3
R_R38         N1799454 N1799512 R_NOISELESS 1E-3
R_R39         GND N1799512 R_NOISELESS 1
R_R40         GND GND_CLP R_NOISELESS 1E9
R_R41         GND N1796248 R_NOISELESS 1E9
R_R42         N1799872 GND R_NOISELESS 1
R_R43         N1799968 N1799872 R_NOISELESS 1E-3
R_R44         N1800040 N1800096 R_NOISELESS 1E-3
R_R45         GND N1800096 R_NOISELESS 1
R_R46         GND N1795224 R_NOISELESS 1E9
R_R49         GND N1797550 R_NOISELESS 1E9
R_R5         N1794800 GND R_NOISELESS 1
R_R50         N1797084 GND R_NOISELESS 1
R_R51         N1797168 N1797084 R_NOISELESS 1E-3
R_R52         N1797268 N1797324 R_NOISELESS 1E-3
R_R53         GND N1797324 R_NOISELESS 1
R_R54         GND N1797496 R_NOISELESS 1E9
R_R55         N1797802 VSENSE R_NOISELESS 1E-3
R_R81         GND N1799794 R_NOISELESS 1E9
R_R83         GND N1800690 R_NOISELESS 1E9
R_RDUMMY         GND N1796118 R_NOISELESS 1E4
R_RX         N1796118 N1797964 R_NOISELESS 1E5
R_R_IN         CMR IN- R_NOISELESS 1.8E-3
R_R_VIMON         VIMON N1799794 R_NOISELESS 100
R_R_VOUT_S         VOUT_S N1800690 R_NOISELESS 100
V_VMEAS         N1799104 CMR 0VDC
V_VSW         SW GND  
+PULSE 0 1 0 300P 300P 2N 4U
V_V_GRN         N1797496 GND -15
V_V_GRP         N1797550 GND 15
V_V_ISCN         N1795224 GND -90
V_V_ISCP         N1796248 GND 90
V_V_MODE         MODE GND {MODE}
X_CLAWN         GND VIMON GND N1796550 CLAWN_TMCS1108A4B 
X_CLAWP         VIMON GND N1795338 VS_B CLAWP_TMCS1108A4B 
X_CLAW_AMP         VS_CLP GND_CLP VOUT_S GND N1799026 N1799512 CLAMP_AMP_LO_TMCS1108A4B 
X_CLAW_SRC         N1799114 N1799454 CLAW_CLAMP GND CLAW_SRC_TMCS1108A4B 
X_CL_AMP         N1796248 N1795224 VIMON GND N1799872 N1800096 CLAMP_AMP_LO_TMCS1108A4B 
X_CL_SRC         N1799968 N1800040 CL_CLAMP GND CL_SRC_TMCS1108A4B 
X_F1    IN+ N1799104 SENS REF 08_COMPLETE_A4B_F1_TMCS1108A4B 
X_GR_AMP         N1797550 N1797496 N1797802 GND N1797084 N1797324 CLAMP_AMP_HI_TMCS1108A4B 
X_GR_SRC         N1797168 N1797268 CLAMP GND GR_SRC_TMCS1108A4B 
X_H3    OUT N1796118 N1799794 GND 08_COMPLETE_A4B_H3_TMCS1108A4B 
X_SAMPLEHOLD         SIG SW SAMPLE SAMPLEHOLD_TMCS1108A4B 
X_S_MODE    MODE GND SAMPLE ACL 08_COMPLETE_A4B_S_MODE_TMCS1108A4B 
X_U1         SENS ACL GND CLAMP AOL_1_TMCS1108A4B 
X_U2         GND CMR FEMT_A4_TMCS1108A4B 
X_U3         CMR GND VICM IBP_VCM_A4B_TMCS1108A4B PARAMS: DC=-1.9964E-2 POL=1 DRIFT=100E-6
X_ZO_SRC         N1796150 GND GND N1797964 ZO_SRC_TMCS1108A4B 
.ENDS  TMCS1108A4B
*
.SUBCKT 08_COMPLETE_A4B_F1_TMCS1108A4B 1 2 3 4  
F_F1         3 4 VF_F1 -3.9846E-7
VF_F1         1 2 0V
.ENDS  08_COMPLETE_A4B_F1_TMCS1108A4B
*
.SUBCKT 08_COMPLETE_A4B_H3_TMCS1108A4B 1 2 3 4  
H_H3         3 4 VH_H3 -1E3
VH_H3         1 2 0V
.ENDS  08_COMPLETE_A4B_H3_TMCS1108A4B
*
.SUBCKT 08_COMPLETE_A4B_S_MODE_TMCS1108A4B 1 2 3 4  
S_S_MODE         3 4 1 2 _S_MODE
RS_S_MODE         1 2 1G
.MODEL         _S_MODE VSWITCH ROFF=1E12 RON=1E-6 VOFF=0.1V VON=0.9V
.ENDS  08_COMPLETE_A4B_S_MODE_TMCS1108A4B
*
.SUBCKT AOL_1_TMCS1108A4B VC+ VC- IOUT+ IOUT-
+ PARAMS:
+ GAIN = 1E-2
+ IPOS = 30M
+ INEG = -30M
G1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}
.ENDS  AOL_1_TMCS1108A4B
*
.SUBCKT CLAMP_AMP_HI_TMCS1108A4B VC+ VC- VIN COM VO+ VO-
.PARAM G=10
GVO+ COM VO+ VALUE = {IF(V(VIN,COM)>V(VC+,COM),((V(VIN,COM)-V(VC+,COM))*G),0)}
GVO- COM VO- VALUE = {IF(V(VIN,COM)<V(VC-,COM),((V(VC-,COM)-V(VIN,COM))*G),0)}
.ENDS  CLAMP_AMP_HI_TMCS1108A4B
*
.SUBCKT CLAMP_AMP_LO_TMCS1108A4B VC+ VC- VIN COM VO+ VO-
.PARAM G=1
GVO+ COM VO+ VALUE = {IF(V(VIN,COM)>V(VC+,COM),((V(VIN,COM)-V(VC+,COM))*G),0)}
GVO- COM VO- VALUE = {IF(V(VIN,COM)<V(VC-,COM),((V(VC-,COM)-V(VIN,COM))*G),0)}
.ENDS  CLAMP_AMP_LO_TMCS1108A4B
*
.SUBCKT CLAWN_TMCS1108A4B VC+ VC- IOUT+ IOUT-
G1 IOUT+ IOUT- TABLE {ABS(V(VC+,VC-))} =
+(0, 2E-5)
+(40, 5E-4)
+(60, 7E-4)
+(80, 1E-3)
+(90, 1.2E-3)
.ENDS  CLAWN_TMCS1108A4B
*
.SUBCKT CLAWP_TMCS1108A4B VC+ VC- IOUT+ IOUT-
G1 IOUT+ IOUT- TABLE {ABS(V(VC+,VC-))} =
+(0, 3E-5)
+(40, 8E-4)
+(60, 1.3E-3)
+(70, 1.7E-3)
+(80, 2E-3)
+(85, 2.5E-3)
+(90, 3E-3)
.ENDS  CLAWP_TMCS1108A4B
*
.SUBCKT CLAW_SRC_TMCS1108A4B VC+ VC- IOUT+ IOUT-
.PARAM GAIN = 1
.PARAM IPOS = 2.7E-2
.PARAM INEG = -2.7E-2
G1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}
.ENDS  CLAW_SRC_TMCS1108A4B
*
.SUBCKT CL_SRC_TMCS1108A4B VC+ VC- IOUT+ IOUT-
.PARAM GAIN = 1
.PARAM IPOS = 5.4E-2
.PARAM INEG = -5.4E-2
G1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}
.ENDS  CL_SRC_TMCS1108A4B
*
.SUBCKT FEMT_A4_TMCS1108A4B 1 2
.PARAM NVRF=227.2E9
.PARAM RNVF={1.184*PWR(NVRF,2)}
E1 3 0 5 0 10
R1 5 0 {RNVF}
R2 5 0 {RNVF}
G1 1 2 3 0 1E-6
.ENDS  FEMT_A4_TMCS1108A4B
*
.SUBCKT GR_SRC_TMCS1108A4B VC+ VC- IOUT+ IOUT-
.PARAM GAIN = 1
.PARAM IPOS = 6E-2
.PARAM INEG = -6E-2
G1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}
.ENDS  GR_SRC_TMCS1108A4B
*
.SUBCKT IBP_VCM_A4B_TMCS1108A4B VINP GND CM_IN
+ PARAMS:
+ DC = -2.571E-2
+ POL = 1
+ DRIFT = 90E-6
G1 GND VINP VALUE={DC+POL*DRIFT*(TEMP-27)}
.ENDS  IBP_VCM_A4B_TMCS1108A4B
*
.SUBCKT SAMPLEHOLD_TMCS1108A4B SIG SW OUT
G1 SIG OUT VALUE={(V(SIG)-V(OUT))*V(SW)}
.ENDS  SAMPLEHOLD_TMCS1108A4B
*
.SUBCKT ZO_SRC_TMCS1108A4B VC+ VC- IOUT+ IOUT-
.PARAM GAIN = 3.333E5
.PARAM IPOS = 1.8E4
.PARAM INEG = -1.8E4
G1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),INEG,IPOS)}
.ENDS  ZO_SRC_TMCS1108A4B
*
