
* OPA4140
*$
*****************************************************************************
* (C) Copyright 2011 Texas Instruments Incorporated. All rights reserved.                                            
*****************************************************************************
** This model is designed as an aid for customers of Texas Instruments.
** TI and its licensors and suppliers make no warranties, either expressed
** or implied, with respect to this model, including the warranties of 
** merchantability or fitness for a particular purpose.  The model is
** provided solely on an "as is" basis.  The entire risk as to its quality
** and performance is with the customer.
*****************************************************************************
*
* This model is subject to change without notice. Texas Instruments
* Incorporated is not responsible for updating this model.
*
*****************************************************************************
*
** Released by: Analog eLab Design Center, Texas Instruments Inc.
* Part: OPA4140
* Date: 01JUL2011
* Model Type: ALL IN ONE
* Simulator: PSPICE
* Simulator Version: 16.0.0.p001
* EVM Order Number: N/A
* EVM Users Guide: N/A
* Datasheet: SBOS498A –JULY 2010–REVISED AUGUST 2010
*
* Model Version: 1.0
*
*****************************************************************************
* 
* Updates:
*
* Version 1.0 : 
* Release to Web
*
*****************************************************************************
*
* GREEN-LIS MACRO-MODEL SIMULATED FEATURES:
*
* OPEN LOOP GAIN AND PHASE VS FREQUENCY WITH RL AND CL EFFECTS
* INPUT COMMON MODE REJECTION WITH FREQUENCY
* POWER SUPPLY REJECTION WITH FREQUENCY
* INPUT IMPEDANCE VS FREQUENCY 
* OUTPUT IMPEDANCE VS FREQUENCY
* INPUT VOLTAGE NOISE VS FREQUENCY
* INPUT CURRENT NOISE VS FREQUENCY 
* OUTPUT VOLTAGE SWING VS OUTPUT CURRENT
* SHORT-CIRCUIT OUTPUT CURRENT
* QUIESCENT CURRENT VS SUPPLY VOLTAGE
* SETTLING TIME VS CAPACITIVE LOAD
* SLEW RATE
* SMALL SIGNAL OVERSHOOT VS CAPACITIVE LOAD
* LARGE SIGNAL RESPONSE
* OVERLOAD RECOVERY TIME
* INPUT BIAS CURRENT
* INPUT VOLTAGE OFFSET
* INPUT COMMON MODE RANGE
* OUTPUT CURRENT COMING THROUGH THE SUPPLY RAILS
*
* THIS MODEL IS APPLICABLE TO OPA140, OPA2140 & OPA4140.
*****************************************************************************
.SUBCKT OPA4140 -IN +IN V- V+ Vout
VAM1        30 31 ; Current Arrow
V7          44 12 0
Vos         30 35 27U
V11         58 59 100M
V10         60 61 100M
V6          11 66 10
V5          67 11 10
V4          63 65 12
V1          64 62 12
V9          78 13 3.5
IS2         V+ 31 1P
IS1         V+ V- 1.8M
IS3         40 V- -500F
V3          83 11 36
V2          11 84 30
XU12        V- 31 IDEAL_D_0
XU8         31 V+ IDEAL_D_0
R4          32 24 10M 
C7          33 34 6.5P 
C8          34 11 7P 
CinnCM      11 33 7P 
XIn11       35 33 FEMT_0
L2          36 11 10U 
XR109       27 11 RNOISE_FREE_0
XR109_2     37 11 RNOISE_FREE_0
XVn11       34 35 VNSE_0
XU14        38 11 39 40 VCVS_LIMIT_0
L3          41 11 100U 
R1          36 38 1 
GVCCS2      11 38 11 42  1
XU13        12 43 IDEAL_D_1
EVCVS5      44 11 V- 11  1
XR109_3     45 46 RNOISE_FREE_0
L1          46 11 100M 
C11         37 11 150F 
XR109_4     26 11 RNOISE_FREE_1
C1          11 47 63.9N 
EVCVS1      15 11 48 49  -1
R38         47 50 10 
VCCVS2_in   49 51
HCCVS2      50 11 VCCVS2_in   1K
XU9         47 11 52 53 VARICAP_0
XU7         47 11 49 54 VC_RES_0
C25         15 52 100F 
R37         53 54 26.135MEG 
C24         15 14 90N 
R32         14 52 1.8K 
R31         52 54 100MEG 
R30         15 52 500K 
EVCVS2      54 11 11 52  20MEG
GVCCS12     11 27 37 11  1U
XU5         16 11 V+ 17 VCVS_LIMIT_1
XU6         11 16 18 V- VCVS_LIMIT_2
C15         V+ V- 10P 
C22         11 23 1P 
R29         23 25 1 
C23         11 28 1P 
C9          55 11 10P 
R26         55 16 10 
C21         11 19 1P 
C20         11 20 1P 
C19         21 11 1P 
C17         22 11 1P 
C16         11 56 1P 
C12         57 11 1P 
R13         48 28 1 
SW14        14 15 19 11  S_VSWITCH_1
SW13        15 14 11 20  S_VSWITCH_2
R36         28 61 1M 
R35         28 59 1M 
SW12        62 58 21 11  S_VSWITCH_3
SW11        60 63 11 22  S_VSWITCH_4
R34         28 64 1K 
R33         28 65 1K 
SW10        67 25 23 11  S_VSWITCH_5
SW9         25 66 11 23  S_VSWITCH_6
R25         68 21 1 
R19         69 22 1 
R16         70 56 1 
R14         71 57 1 
R12         72 19 1 
R7          73 20 1 
R5          74 26 10M 
R6          75 25 10M 
R15         0 11 100MEG 
C13         26 11 100F 
GVCCS1      11 26 27 11  1M
GIsinking   V- 11 76 11  1M
GIsourcing  V+ 11 77 11  1M
R23         76 11 10K 
SW7         16 76 55 11  S_VSWITCH_7
R21         11 77 10K 
SW8         16 77 55 11  S_VSWITCH_8
SW4         75 72 19 11  S_VSWITCH_9
SW3         73 75 11 20  S_VSWITCH_10
XU3         63 29 73 11 VCVS_LIMIT_3
XU1         62 29 72 11 VCVS_LIMIT_3
SW2         32 68 21 11  S_VSWITCH_11
SW1         69 32 11 22  S_VSWITCH_12
EVCVS6      78 11 V+ 11  1
R22         79 43 100 
EVCVS4      79 11 31 11  1
XU2         43 13 IDEAL_D_1
SW6         74 70 56 11  S_VSWITCH_13
SW5         71 74 11 57  S_VSWITCH_14
XU26        43 40 11 80 VCCS_LIMIT_0
XU4         80 11 11 25 VCCS_LIMIT_1
LPSR        81 11 100M 
XVCVSPSRR   82 11 39 33 VCVS_LIMIT_4
XU22        83 16 69 11 VCVS_LIMIT_5
XU21        84 16 68 11 VCVS_LIMIT_5
XU20        18 Vout 70 11 VCVS_LIMIT_5
XU19        17 Vout 71 11 VCVS_LIMIT_6
XU11        V- 40 IDEAL_D_0
XU10        40 V+ IDEAL_D_0
C10         24 11 100F 
C5          27 11  1.00000000000000E-0016 
XR109_5     24 11 RNOISE_FREE_1
GVCCS15     11 24 26 11  1M
GVCCS10     11 37 45 11  1U
R20         +IN 34 100 
R18         -IN 33 100 
GVCCS6      11 45 29 11  1U
XR102       85 86 RNOISE_FREE_0
XR101       87 85 RNOISE_FREE_0
C6          85 0 1 
XR105       29 11 RNOISE_FREE_0
XR104       25 11 RNOISE_FREE_2
XR103       11 80 RNOISE_FREE_0
EVCVS34     11 0 85 0  1
RPSR        81 82 1 
GVCCS11     11 82 V+ V-  100N
RCM         41 42 1 
EVCVS29     87 0 V+ 0  1
EVCVS28     86 0 V- 0  1
GVCCS7      11 42 30 11  100N
VCCVS1_in   51 Vout
HCCVS1      16 11 VCCVS1_in   1K
GVCCS5      11 29 25 11  1U
Ccc         25 11 7U 
EVCVS3      48 11 24 11  1
.MODEL S_VSWITCH_1 VSWITCH (RON=1 ROFF=100MEG VON=100M VOFF=-100M)
.MODEL S_VSWITCH_2 VSWITCH (RON=1 ROFF=100MEG VON=100M VOFF=-100M)
.MODEL S_VSWITCH_3 VSWITCH (RON=1 ROFF=10MEG VON=100M VOFF=-100M)
.MODEL S_VSWITCH_4 VSWITCH (RON=1 ROFF=10MEG VON=100M VOFF=-100M)
.MODEL S_VSWITCH_5 VSWITCH (RON=10M ROFF=100MEG VON=150 VOFF=0)
.MODEL S_VSWITCH_6 VSWITCH (RON=10M ROFF=100MEG VON=150 VOFF=0)
.MODEL S_VSWITCH_7 VSWITCH (RON=1M ROFF=10MEG VON=-10M VOFF=0)
.MODEL S_VSWITCH_8 VSWITCH (RON=1M ROFF=10MEG VON=10M VOFF=0)
.MODEL S_VSWITCH_9 VSWITCH (RON=1 ROFF=10MEG VON=1 VOFF=-1)
.MODEL S_VSWITCH_10 VSWITCH (RON=1 ROFF=10MEG VON=1 VOFF=-1)
.MODEL S_VSWITCH_11 VSWITCH (RON=1 ROFF=1G VON=10 VOFF=-10)
.MODEL S_VSWITCH_12 VSWITCH (RON=1 ROFF=1G VON=10 VOFF=-10)
.MODEL S_VSWITCH_13 VSWITCH (RON=1 ROFF=1G VON=10 VOFF=-10)
.MODEL S_VSWITCH_14 VSWITCH (RON=1 ROFF=1G VON=10 VOFF=-10)
.ENDS OPA4140

*$

*TG IDEAL DIODE
.SUBCKT IDEAL_D_0  A C
D1 A C DNOM 
.MODEL DNOM D (TT=10P CJO=1E-18 IS=1E-15 RS=1E-3)
.ENDS IDEAL_D_0 

*$

* BEGIN PROG NSE FEMTO AMP/RT-HZ 
.SUBCKT FEMT_0  1 2
* BEGIN SETUP OF NOISE GEN - FEMPTOAMPS/RT-HZ
* INPUT THREE VARIABLES
* SET UP INSE 1/F
* FA/RHZ AT 1/F FREQ
.PARAM NLFF=.1
* FREQ FOR 1/F VAL
.PARAM FLWF=0.001
* SET UP INSE FB
* FA/RHZ FLATBAND
.PARAM NVRF=.1
* END USER INPUT
* START CALC VALS
.PARAM GLFF={PWR(FLWF,0.25)*NLFF/1164}
.PARAM RNVF={1.184*PWR(NVRF,2)}
.MODEL DVNF D KF={PWR(FLWF,0.5)/1E11} IS=1.0E-16
* END CALC VALS
I1 0 7 10E-3
I2 0 8 10E-3
D1 7 0 DVNF
D2 8 0 DVNF
E1 3 6 7 8 {GLFF}
R1 3 0 1E9
R2 3 0 1E9
R3 3 6 1E9
E2 6 4 5 0 10
R4 5 0 {RNVF}
R5 5 0 {RNVF}
R6 3 4 1E9
R7 4 0 1E9
G1 1 2 3 4 1E-6
C1 1 0 1E-15
C2 2 0 1E-15
C3 1 2 1E-15
.ENDS
* END PROG NSE FEMTO AMP/RT-HZ

*$

* NOISELESS RESISTOR
.SUBCKT RNOISE_FREE_0  1 2
*ROHMS = VALUE IN OHMS OF NOISELESS RESISTOR
.PARAM ROHMS=1E6
ERES 1 3 VALUE = { I(VSENSE) * ROHMS }
RDUMMY 30 3 1
VSENSE 30 2 DC 0V
.ENDS RNOISE_FREE_0 

*$

* BEGIN PROG NSE NANO VOLT/RT-HZ
.SUBCKT VNSE_0  1 2
* BEGIN SETUP OF NOISE GEN - NANOVOLT/RT-HZ
* INPUT THREE VARIABLES
* SET UP VNSE 1/F
* NV/RHZ AT 1/F FREQ
.PARAM NLF=18
* FREQ FOR 1/F VAL
.PARAM FLW=1
* SET UP VNSE FB
* NV/RHZ FLATBAND
.PARAM NVR=4.6
* END USER INPUT
* START CALC VALS
.PARAM GLF={PWR(FLW,0.25)*NLF/1164}
.PARAM RNV={1.184*PWR(NVR,2)}
.MODEL DVN D KF={PWR(FLW,0.5)/1E11} IS=1.0E-16
* END CALC VALS
I1 0 7 10E-3
I2 0 8 10E-3
D1 7 0 DVN
D2 8 0 DVN
E1 3 6 7 8 {GLF}
R1 3 0 1E9
R2 3 0 1E9
R3 3 6 1E9
E2 6 4 5 0 10
R4 5 0 {RNV}
R5 5 0 {RNV}
R6 3 4 1E9
R7 4 0 1E9
E3 1 2 3 4 1
C1 1 0 1E-15
C2 2 0 1E-15
C3 1 2 1E-15
.ENDS
* END PROG NSE NANOV/RT-HZ

*$

*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_0  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = 1
.PARAM VPOS = 10M
.PARAM VNEG = -10M
E1 VOUT+ VOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),VPOS,VNEG)}
.ENDS VCVS_LIMIT_0 

*$

*TG IDEAL DIODE
.SUBCKT IDEAL_D_1  A C
D1 A C DNOM
.MODEL DNOM D (TT=10P CJO=1E-18 IS=1E-15 RS=1E-3)
.ENDS IDEAL_D_1 

*$

* NOISELESS RESISTOR
.SUBCKT RNOISE_FREE_1  1 2
*ROHMS = VALUE IN OHMS OF NOISELESS RESISTOR
.PARAM ROHMS=1E3
ERES 1 3 VALUE = { I(VSENSE) * ROHMS }
RDUMMY 30 3 1
VSENSE 30 2 DC 0V
.ENDS RNOISE_FREE_1 

*$

*VARICAP (VOLTAGE-CONTROLLED CAPACITOR
.SUBCKT VARICAP_0  1 2 3 4
*PINS       VC+ VC- CAP+ CAP-
R1 3 10 1U
VC 10 20 0
EC 20 4 VALUE = {(1/(((ABS(V(1,2))*(-2.08)+204.636))))*V(INT)*100000000000000000}
GINT 0 INT VALUE = {I(VC)}
CINT INT 0 1
********* Add large R from INT to gnd
RINT INT 0 1e9
.ENDS VARICAP_0 

*$

*VOLTAGE CONTROLLED RESISTOR
.SUBCKT VC_RES_0  1      2      3    4
*              VC+    VC-   RES1 RES2
ERES 3 40 VALUE = {(I(VSENSE) * (ABS(V(1,2))*ABS(V(1,2))*0.000352-0.02359*ABS(V(1,2))+0.5922))*140000*24200*50*2/414500}
VSENSE 40 4 DC 0
.ENDS VC_RES_0 

*$

*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_1  VC+ VC- VOUT+ VOUT-
*              
*$
E1 VOUT+ VOUT- TABLE {ABS(V(VC+,VC-))} = (0,0.2) (10,0.25) 25,0.4) (35.9,0.6)
.ENDS VCVS_LIMIT_1 

*$

*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_2  VC+ VC- VOUT+ VOUT-
*              
E1 VOUT+ VOUT- TABLE {ABS(V(VC+,VC-))} = (0,0.2) (10,0.25) (20,0.35) (29,0.5)
.ENDS VCVS_LIMIT_2 

*$

*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_3  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = 100
.PARAM VPOS = 6000
.PARAM VNEG = -6000
E1 VOUT+ VOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),VPOS,VNEG)}
.ENDS VCVS_LIMIT_3 

*$

*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCCS_LIMIT_0  VC+ VC- IOUT+ IOUT-
*              
.PARAM GAIN = 100U
.PARAM IPOS = .5
.PARAM INEG = -.5
G1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),IPOS,INEG)}
.ENDS VCCS_LIMIT_0 

*$

*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCCS_LIMIT_1  VC+ VC- IOUT+ IOUT-
*              
.PARAM GAIN = 5
.PARAM IPOS = 140
.PARAM INEG = -140
G1 IOUT+ IOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),IPOS,INEG)}
.ENDS VCCS_LIMIT_1 

*$

*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_4  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = -1
.PARAM VPOS = 10M
.PARAM VNEG = -10M
E1 VOUT+ VOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),VPOS,VNEG)}
.ENDS VCVS_LIMIT_4 

*$

*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_5  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = 100
.PARAM VPOS = 5000
.PARAM VNEG = -5000
E1 VOUT+ VOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),VPOS,VNEG)}
.ENDS VCVS_LIMIT_5 

*$

*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_6  VC+ VC- VOUT+ VOUT-
*             
.PARAM GAIN = 100
.PARAM VPOS = 5000
.PARAM VNEG = -5000
E1 VOUT+ VOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),VPOS,VNEG)}
.ENDS VCVS_LIMIT_6 

*$

* NOISELESS RESISTOR
.SUBCKT RNOISE_FREE_2  1 2
*ROHMS = VALUE IN OHMS OF NOISELESS RESISTOR
.PARAM ROHMS=1E4
ERES 1 3 VALUE = { I(VSENSE) * ROHMS }
RDUMMY 30 3 1
VSENSE 30 2 DC 0V
.ENDS RNOISE_FREE_2 

*$
